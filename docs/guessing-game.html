<html><head><title>tuco</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Rob Norris" /><meta name="description" content="Tuco is a reasonable telnet server for Scala." /><meta name="og:image" content="/tuco/img/poster.png" /><meta name="og:title" content="tuco" /><meta name="og:site_name" content="tuco" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Tuco is a reasonable telnet server for Scala." /><link rel="icon" type="image/png" href="/tuco/img/favicon.png" /><meta name="twitter:title" content="tuco" /><meta name="twitter:image" content="img/poster.png" /><meta name="twitter:description" content="Tuco is a reasonable telnet server for Scala." /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/tuco/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/tuco/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/tuco/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/tuco/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/tuco/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/tuco/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/tuco/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/tuco/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/tuco/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/tuco/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/tuco/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/tuco/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/tuco/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/tuco/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/tuco/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/tuco/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/tuco/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/tuco/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/tuco/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/tuco/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/tuco/highlight/styles/color-brewer.css" /><link rel="stylesheet" href="/tuco/css/style.css" /><link rel="stylesheet" href="/tuco/css/palette.css" /><link rel="stylesheet" href="/tuco/css/codemirror.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/tuco/" class="brand"><div class="brand-wrapper"><span>tuco</span></div></a></li> <li><a href="/tuco/docs/index.html" class="">How to Learn</a></li> <li><a href="/tuco/docs/hello-world.html" class="">Hello World</a></li> <li><a href="/tuco/docs/guessing-game.html" class=" active ">A Guessing Game</a></li> <li><a href="/tuco/docs/todo-list.html" class="">Command Shell To-Do List</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/tpolecat/tuco"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/tpolecat/tuco"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('tuco Tuco is a reasonable telnet server for Scala.');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('tuco Tuco is a reasonable telnet server for Scala.');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="tpolecat" data-github-repo="tuco"><div class="content-wrapper"><section><p><em>The program described here is also available as <code class="highlighter-rouge">GuessingGame.scala</code> in the <code class="highlighter-rouge">examples</code> project.</em></p>

<h2 id="a-guessing-game">A Guessing Game</h2>

<p>For our next <strong>Tuco</strong> program we will build a telnet server that plays a guessing game with the user. We will need some additional imports.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">scala.util.</span><span class="o">{</span> <span class="nc">Random</span><span class="o">,</span> <span class="nc">Try</span><span class="o">,</span> <span class="nc">Success</span><span class="o">,</span> <span class="nc">Failure</span> <span class="o">}</span>
<span class="k">import</span> <span class="nn">cats._</span><span class="o">,</span> <span class="n">cats</span><span class="o">.</span><span class="n">implicits</span><span class="o">.</span><span class="k">_</span><span class="o">,</span> <span class="n">cats</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="nc">Comparison</span><span class="o">.</span><span class="k">_</span><span class="o">,</span> <span class="n">cats</span><span class="o">.</span><span class="n">effect</span><span class="o">.</span><span class="k">_</span>
<span class="k">import</span> <span class="nn">tuco._</span><span class="o">,</span> <span class="nc">Tuco</span><span class="o">.</span><span class="k">_</span>
</code></pre>
</div>

<p>This time our behavior is a bit different. We say hello and goodbye much a before, but the main gameplay is delegated to a <code class="highlighter-rouge">loop</code> program that we will define later. (If youâ€™re following along in the REPL skip this definition until we have defined <code class="highlighter-rouge">loop</code>.)</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="n">game</span><span class="o">(</span><span class="n">r</span><span class="k">:</span> <span class="kt">Random</span><span class="o">)</span><span class="k">:</span> <span class="kt">SessionIO</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span>
  <span class="k">for</span> <span class="o">{</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">writeLn</span><span class="o">(</span><span class="s">"Welcome to the guessing game!"</span><span class="o">)</span>
    <span class="n">a</span> <span class="k">&lt;-</span> <span class="nc">SessionIO</span><span class="o">.</span><span class="n">delay</span><span class="o">(</span><span class="n">r</span><span class="o">.</span><span class="n">nextInt</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">writeLn</span><span class="o">(</span><span class="s">"I have chosen a number between 1 and 10, what is it?"</span><span class="o">)</span>
    <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">loop</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span> <span class="c1">// guessing loop with initial turn count of 1
</span>    <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">writeLn</span><span class="o">(</span><span class="s">"Goodbye."</span><span class="o">)</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="o">()</span>
</code></pre>
</div>

<p>Note that the random number generation is a side-effect, which we must capture via the <code class="highlighter-rouge">SessionIO.delay</code> operation. This gives us an FFI to the unsafe part of the language analogous to scalaz <code class="highlighter-rouge">Task.delay</code> or <code class="highlighter-rouge">IO.apply</code>.</p>

<p>Because we will be reading an <code class="highlighter-rouge">Int</code> from the user, we need to provide a program that knows how to do this. So we define the following program that prompts the user, attempts to parse the input, and either returns the value or reports an error and tries again.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="n">readInt</span><span class="o">(</span><span class="n">prompt</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">SessionIO</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span>
  <span class="n">readLn</span><span class="o">(</span><span class="n">prompt</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="n">s</span> <span class="k">=&gt;</span> <span class="nc">Try</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="n">toInt</span><span class="o">)).</span><span class="n">flatMap</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">Failure</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">writeLn</span><span class="o">(</span><span class="s">"That's not a number! Try again."</span><span class="o">)</span> <span class="o">*&gt;</span> <span class="n">readInt</span><span class="o">(</span><span class="n">prompt</span><span class="o">)</span>
    <span class="k">case</span> <span class="nc">Success</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">SessionIO</span><span class="o">.</span><span class="n">pure</span><span class="o">(</span><span class="n">n</span><span class="o">)</span>
  <span class="o">}</span>
</code></pre>
</div>

<p>With that out of the way we can implement our game loop. We read an <code class="highlighter-rouge">Int</code> then compare it with our answer, either giving the user a clue and looping, or congratulating the user if the guess is correct.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="n">loop</span><span class="o">(</span><span class="n">answer</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">guesses</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">SessionIO</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span>
  <span class="n">readInt</span><span class="o">(</span><span class="s">"Your guess? "</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="k">_</span> <span class="n">comparison</span> <span class="n">answer</span><span class="o">).</span><span class="n">flatMap</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">LessThan</span>    <span class="k">=&gt;</span> <span class="n">writeLn</span><span class="o">(</span><span class="s">"Nope, higher!"</span><span class="o">)</span> <span class="o">*&gt;</span> <span class="n">loop</span><span class="o">(</span><span class="n">answer</span><span class="o">,</span> <span class="n">guesses</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
    <span class="k">case</span> <span class="nc">GreaterThan</span> <span class="k">=&gt;</span> <span class="n">writeLn</span><span class="o">(</span><span class="s">"Nope, lower!"</span><span class="o">)</span>  <span class="o">*&gt;</span> <span class="n">loop</span><span class="o">(</span><span class="n">answer</span><span class="o">,</span> <span class="n">guesses</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
    <span class="k">case</span> <span class="nc">EqualTo</span>     <span class="k">=&gt;</span> <span class="k">if</span> <span class="o">(</span><span class="n">guesses</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="n">writeLn</span><span class="o">(</span><span class="s">"Good guess! You won on the first try!"</span><span class="o">)</span>
                        <span class="k">else</span> <span class="n">writeLn</span><span class="o">(</span><span class="n">s</span><span class="s">"Right! It took $guesses tries."</span><span class="o">)</span>
  <span class="o">}</span>
</code></pre>
</div>

<p>Our game is fully implemented and we can define the server config.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">conf</span> <span class="k">=</span> <span class="nc">Config</span><span class="o">[</span><span class="kt">IO</span><span class="o">](</span><span class="n">game</span><span class="o">(</span><span class="k">new</span> <span class="nc">Random</span><span class="o">(</span><span class="mi">123L</span><span class="o">)),</span> <span class="mi">6666</span><span class="o">)</span>
</code></pre>
</div>

<p>Start the server up.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="n">stop</span> <span class="k">=</span> <span class="n">conf</span><span class="o">.</span><span class="n">start</span><span class="o">.</span><span class="n">unsafeRunSync</span>
<span class="n">stop</span><span class="k">:</span> <span class="kt">cats.effect.IO</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="nc">IO$994779110</span>
</code></pre>
</div>

<p>We can now connect on port 6666 via telnet and enjoy our fabulous game.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ telnet localhost 6666
Trying ::1...
Connected to localhost.
Escape character is '^]'.
Welcome to the guessing game!
I have chosen a number between 1 and 10, what is it?
Your guess? five
That's not a number! Try again.
Your guess? 5
Nope, lower!
Your guess? 3
Right! It took 2 tries.
Goodbye.
</code></pre>
</div>

<p>Shut the server down when youâ€™re done playing.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="n">scala</span><span class="o">&gt;</span> <span class="n">stop</span><span class="o">.</span><span class="n">unsafeRunSync</span>
</code></pre>
</div>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/tuco/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script src="/tuco/js/main.js"></script></body></html>